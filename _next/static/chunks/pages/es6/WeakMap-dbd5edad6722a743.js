(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{3110:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/es6/WeakMap",function(){return a(4059)}])},250:function(e,n,a){"use strict";var t=a(5893);n.Z={projectLink:"https://github.com/frankdou/frankdou.github.io",docsRepositoryBase:"https://github.com/frankdou/frankdou.github.io/blob/master",titleSuffix:" \u2013 frankdou.github.io",defaultMenuCollapsed:!1,logo:(0,t.jsx)(t.Fragment,{children:"\u524d\u7aef\u7b14\u8bb0"}),head:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,t.jsx)("meta",{name:"description",content:"\u524d\u7aef\u7b14\u8bb0"}),(0,t.jsx)("meta",{name:"apple-mobile-web-app-title",content:"\u524d\u7aef\u7b14\u8bb0"})]})}},4059:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return m}});var t=a(5893),o=a(5716),r=a(3805),s=a(250),l=a(1151);function c(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{},t=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),t.forEach((function(n){c(e,n,a[n])}))}return e}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=function(){var n=Object.assign({ul:"ul",li:"li",pre:"pre",code:"code",h5:"h5",p:"p"},(0,l.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e0eMap\u7ed3\u6784\u7c7b\u4f3c\uff0c\u7528\u4e8e\u751f\u6210\u952e\u503c\u5bf9\u7684\u96c6\u5408"}),"\n",(0,t.jsx)(n.li,{children:"\u53ea\u63a5\u53d7\u5bf9\u8c61\u4f5c\u4e3a\u952e\u540d\uff0c\u4e0d\u63a5\u53d7\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u503c\u4f5c\u4e3a\u952e\u540d\uff08\u6bd4\u5982 Symbol\u3001null\uff09"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const map = new WeakMap();\n\n// \u5747\u4e3a\uff1aTypeError: Invalid value used as weak map key\nmap.set(1, 2)\nmap.set(Symbol(), 2)\nmap.set(null, 2)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const wm = new WeakMap(),\n      wm2 = new WeakMap();\n\nconst o1 = {},\n      o2 = function(){\n        console.log('this is o2');\n      },\n      o3 = global;\n\n//\u952e\u4e0d\u80fd\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\n//TypeError: Invalid value used as weak map key\nwm.set('a', o2);\n\n// value\u53ef\u4ee5\u662f\u4efb\u610f\u503c\nwm.set(o1, o2); \nwm.set(o2, \"azerty\");\n\nwm2.set(o3, undefined);\n\n// \u952e\u751a\u81f3\u53ef\u4ee5\u662f\u53e6\u5916\u4e00\u4e2aWeakMap\u5bf9\u8c61\nwm2.set(wm, wm); \n\n//[Function: o2]\nconsole.log(wm.get(o1));\n// \"azerty\"\nconsole.log(wm.get(o2)); \n\n// undefined\nconsole.log(wm2.get(o3));\n// true (\u5373\u4f7f\u503c\u662fundefined)\nconsole.log(wm2.has(o3)); \n// this is o2\nwm2.get(wm).get(o1)()\n"})}),"\n",(0,t.jsx)(n.h5,{children:"\u5f31\u5f15\u7528"}),"\n",(0,t.jsx)(n.p,{children:"\u952e\u540d\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u90fd\u662f\u5f31\u5f15\u7528\uff0c\u5373\u5783\u573e\u56de\u6536\u673a\u5236\u4e0d\u5c06\u8be5\u5f15\u7528\u8003\u8651\u5728\u5185"}),"\n",(0,t.jsx)(n.p,{children:"\u53ea\u8981\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u7684\u5176\u4ed6\u5f15\u7528\u90fd\u88ab\u6e05\u9664\uff0c\u5783\u573e\u56de\u6536\u673a\u5236\u5c31\u4f1a\u91ca\u653e\u8be5\u5bf9\u8c61\u6240\u5360\u7528\u7684\u5185\u5b58\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u4e0d\u518d\u9700\u8981\uff0cWeakMap \u91cc\u9762\u7684\u952e\u540d\u5bf9\u8c61\u548c\u6240\u5bf9\u5e94\u7684\u952e\u503c\u5bf9\u4f1a\u81ea\u52a8\u6d88\u5931\uff0c\u4e0d\u7528\u624b\u52a8\u5220\u9664\u5f15\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const e1 = document.getElementById('foo');\nconst e2 = document.getElementById('bar');\nconst arr = [\n  [e1, 'foo \u5143\u7d20'],\n  [e2, 'bar \u5143\u7d20'],\n];\n\n// \u4e0d\u9700\u8981 e1 \u548c e2 \u7684\u65f6\u5019\n// \u5fc5\u987b\u624b\u52a8\u5220\u9664\u5f15\u7528\uff0c\u5426\u5219\u5783\u573e\u56de\u6536\u673a\u5236\u5c31\u4e0d\u4f1a\u91ca\u653ee1\u548ce2\u5360\u7528\u7684\u5185\u5b58\uff0c\u589e\u52a0\u4e86\u5185\u5b58\u6cc4\u6f0f\u7684\u98ce\u9669\narr[0] = null;\narr[1] = null;\n"})}),"\n",(0,t.jsx)(n.h5,{children:"\u5f31\u5f15\u7528\u6d4b\u8bd5"}),"\n",(0,t.jsx)(n.p,{children:"node"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"//--expose-gc\u53c2\u6570\u8868\u793a\u5141\u8bb8\u624b\u52a8\u6267\u884c\u5783\u573e\u56de\u6536\u673a\u5236\nnode --expose-gc\n\n// \u624b\u52a8\u6267\u884c\u4e00\u6b21\u5783\u573e\u56de\u6536\uff0c\u4fdd\u8bc1\u83b7\u53d6\u7684\u5185\u5b58\u4f7f\u7528\u72b6\u6001\u51c6\u786e\n> global.gc();\nundefined\n\n// \u67e5\u770b\u5185\u5b58\u5360\u7528\u7684\u521d\u59cb\u72b6\u6001\uff0cheapUsed \u4e3a 4M \u5de6\u53f3\n> process.memoryUsage();\n{ rss: 21106688,\n  heapTotal: 7376896,\n  heapUsed: 4153936,\n  external: 9059 }\n\n> let wm = new WeakMap();\nundefined\n\n// \u65b0\u5efa\u4e00\u4e2a\u53d8\u91cf key\uff0c\u6307\u5411\u4e00\u4e2a 5*1024*1024 \u7684\u6570\u7ec4\n> let key = new Array(5 * 1024 * 1024);\nundefined\n\n// \u8bbe\u7f6e WeakMap \u5b9e\u4f8b\u7684\u952e\u540d\uff0c\u4e5f\u6307\u5411 key \u6570\u7ec4\n// \u8fd9\u65f6\uff0ckey \u6570\u7ec4\u5b9e\u9645\u88ab\u5f15\u7528\u4e86\u4e24\u6b21\uff0c\n// \u53d8\u91cf key \u5f15\u7528\u4e00\u6b21\uff0cWeakMap \u7684\u952e\u540d\u5f15\u7528\u4e86\u7b2c\u4e8c\u6b21\n// \u4f46\u662f\uff0cWeakMap \u662f\u5f31\u5f15\u7528\uff0c\u5bf9\u4e8e\u5f15\u64ce\u6765\u8bf4\uff0c\u5f15\u7528\u8ba1\u6570\u8fd8\u662f1\n> wm.set(key, 1);\nWeakMap {}\n\n> global.gc();\nundefined\n\n// \u8fd9\u65f6\u5185\u5b58\u5360\u7528 heapUsed \u589e\u52a0\u5230 45M \u4e86\n> process.memoryUsage();\n{ rss: 67538944,\n  heapTotal: 7376896,\n  heapUsed: 45782816,\n  external: 8945 }\n\n// \u6e05\u9664\u53d8\u91cf key \u5bf9\u6570\u7ec4\u7684\u5f15\u7528\uff0c\n// \u4f46\u6ca1\u6709\u624b\u52a8\u6e05\u9664 WeakMap \u5b9e\u4f8b\u7684\u952e\u540d\u5bf9\u6570\u7ec4\u7684\u5f15\u7528\n> key = null;\nnull\n\n// \u518d\u6b21\u6267\u884c\u5783\u573e\u56de\u6536\n> global.gc();\nundefined\n\n// \u5185\u5b58\u5360\u7528 heapUsed \u53d8\u56de 4M \u5de6\u53f3\uff0c\n// \u53ef\u4ee5\u770b\u5230 WeakMap \u7684\u952e\u540d\u5f15\u7528\u6ca1\u6709\u963b\u6b62 gc \u5bf9\u5185\u5b58\u7684\u56de\u6536\n> process.memoryUsage();\n{ rss: 20639744,\n  heapTotal: 8425472,\n  heapUsed: 3979792,\n  external: 8956 }\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6d4f\u89c8\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"<div id=\"target\">target</div>\n<div id=\"remove\">remove</div>\n<div id=\"check\">check</div>\n\nlet myWeakmap = new WeakMap();\n\ndocument.getElementById('target').addEventListener('click', function () {\n    myWeakmap.set(document.getElementById('target'), 1111)\n    console.log(myWeakmap);\n}, false);\n\ndocument.getElementById('remove').addEventListener('click', function () {\n    document.getElementById('target').remove()\n}, false);\n\ndocument.getElementById('check').addEventListener('click', function () {\n    console.log(myWeakmap);\n}, false);\n\n//\u5f53remove\u4e4b\u540e\uff0cWeakMap\u4f1a\u7f6e\u7a7a\xa0{}\n"})}),"\n",(0,t.jsx)(n.h5,{children:"\u4e0eMap\u7684\u533a\u522b"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6ca1\u6709\u904d\u5386\u64cd\u4f5c\uff08\u5373\u6ca1\u6709keys()\u3001values()\u548centries()\u65b9\u6cd5\uff09\uff0c\u4e5f\u6ca1\u6709size\u5c5e\u6027\uff0c\u56e0\u4e3a\u6ca1\u6709\u529e\u6cd5\u5217\u51fa\u6240\u6709\u952e\u540d"}),"\n",(0,t.jsx)(n.li,{children:"\u65e0\u6cd5\u6e05\u7a7a\uff0c\u5373\u4e0d\u652f\u6301clear\u65b9\u6cd5"}),"\n"]})]})},a=Object.assign({},(0,l.ah)(),e.components),o=a.wrapper;return o?(0,t.jsx)(o,i({},e,{children:(0,t.jsx)(n,{})})):n()}var u=(0,t.jsx)(d,{});function m(e){return(0,r.withSSG)((0,o.Z)({filename:"WeakMap.md",route:"/es6/WeakMap",meta:{},pageMap:[{name:"es6",children:[{name:"Class",route:"/es6/Class"},{name:"Intl",route:"/es6/Intl"},{name:"Map",route:"/es6/Map"},{name:"Proxy",route:"/es6/Proxy"},{name:"Reflect",route:"/es6/Reflect"},{name:"Set",route:"/es6/Set"},{name:"Symbol",route:"/es6/Symbol"},{name:"WeakMap",route:"/es6/WeakMap"},{name:"WeakSet",route:"/es6/WeakSet"}],route:"/es6"},{name:"index",route:"/",frontMatter:{type:"page",title:"About"}}]},s.Z))(i({},e,{children:u}))}}},function(e){e.O(0,[847,774,888,179],(function(){return n=3110,e(e.s=n);var n}));var n=e.O();_N_E=n}]);