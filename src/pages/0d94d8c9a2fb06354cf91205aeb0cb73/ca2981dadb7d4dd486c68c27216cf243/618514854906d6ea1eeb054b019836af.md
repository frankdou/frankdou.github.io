---
title: 最佳实践
size: 1855
---
store入口文件
```js
import { configureStore, combineReducers } from "@reduxjs/toolkit"
import aReducer from './aReducer'

const setupStore = (preloadedState?: any) =>
    configureStore({
        reducer: combineReducers({
            a: aReducer,
            ...
        }),
        preloadedState,
    })

export default async () => {
	// run async functions
	...
	
    const preloadedState = {
        xxxx: {
            xxxx,
            ....
            ....
        },
    }

    return setupStore(preloadedState)
}

export type RootState = ReturnType<ReturnType<typeof setupStore>["getState"]>
export type AppDispatch = ReturnType<typeof setupStore>["dispatch"]
```

aReducer
```ts
import { createSlice } from "@reduxjs/toolkit"
import type { PayloadAction } from "@reduxjs/toolkit"

export interface GlobalState {
  [key: string]: unknown
}

const initialState: GlobalState = {}

export const Reducer = createSlice({
    name: "aReducer",
    initialState,
    reducers: {
        set: (state, action) => {
            state = action?.payload || {}
        },
	    clear: (state, action) => {
            state = {}
        },
        patchUpdate: (state, action: PayloadAction<Partial<GlobalState>>) => {
            const payload = action.payload

            Object.keys(payload).forEach((key) => {
                state[key] = payload[key]
            })
        },
    },
})

export const { set, clear, patchUpdate } = Reducer.actions

export default Reducer.reducer
```

应用入口文件
```jsx

import React, { useMemo } from 'react'
import { Provider } from 'react-redux'
import getStore from '@/store'
...

(async (props) => {
    const store = await getStore()
    const states = store.getState()

    return (
        ...
            <Provider store={store}>
                ...
            </Provider>
        ...
    )
})()
```
