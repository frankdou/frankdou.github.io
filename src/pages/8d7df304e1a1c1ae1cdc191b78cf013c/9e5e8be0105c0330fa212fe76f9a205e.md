---
title: websocket心跳机制
size: 938
---
#### 心跳机制（Heartbeat）
在 WebSocket 连接中扮演着至关重要的角色，主要目的是**维持连接的活跃性并检测连接是否断开**。
##### 存在原因
许多网络设备（如路由器、防火墙）为了节省资源，会主动关闭长时间没有数据传输的连接。即使 WebSocket 连接没有数据传输，底层的 TCP 连接也可能因为这些设备策略而被断开。心跳机制通过定期发送少量数据来模拟活跃，防止连接被意外关闭
##### 实现方式
- 定时发送 Ping： 一方（通常是服务器）会定时发送 Ping 帧给另一方。
- 超时检测 Pong： 发送 Ping 后，会启动一个定时器，如果在指定时间内没有收到 Pong 帧，则认为连接已断开。
- 空闲检测： 如果在一定时间内没有数据传输（包括应用数据和心跳帧），则触发心跳机制

ps：通常客户端（浏览器）会自动响应ping
