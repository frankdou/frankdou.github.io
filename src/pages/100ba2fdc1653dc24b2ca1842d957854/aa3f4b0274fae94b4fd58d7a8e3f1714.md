---
title: v8垃圾回收机制
date: 2022-04-14T12:00:22.515Z
size: 1546
---
JavaScript在创建变量（对象，字符串等）时自动进行了内存分配，并且在不使用它们时“自动”释放。 这一过程称为垃圾回收



##### 内存生命周期

1. 分配你所需要的内存
2. 使用分配到的内存（读、写）
3. 不需要时将其释放(归还)



#### V8

在 V8 内部，会为程序中的所有变量构建一个图，来表示变量间的关联关系，当变量从根节点无法触达时，就意味着这个变量不会再被使用了，就是可以回收的了



##### 堆内存

- 新生代
  - 所有新创建的变量进入该内存区域
  - 存活时间较短的对象
  - 特点
    - 容量小
    - 垃圾回收更快
    - 将占用的堆内存一分为二，from、to
- 老生代
  - 多次在新生代的未被清理掉的变量
  - 存活时间较长，或者常驻内存的对象
  - 特点
    - 容量大
    - 垃圾回收更慢
    - 标记阶段，遍历所有对象，标记存活的对象、清除未标记的对象
      - 该动作，会造成内存碎片（非连续的内存空间）
      - 在整理的过程中，存活对象往一边移动，移动完成后，直接清理掉边界外内存

##### 全停顿

为避免js应用逻辑和垃圾回收内容不一致，垃圾回收的相关算法需要将应用逻辑暂停，待垃圾回收执行完成，再恢复执行应用逻辑

##### 增量标记

为降低全堆垃圾回收造成的停顿时间，v8将标记的动作拆分为小的动作，和应用逻辑交替执行，直至标记阶段完成
