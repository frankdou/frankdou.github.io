---
title: js垃圾回收机制
date: 2023-07-02T10:04:15.289Z
size: 2454
---
JavaScript在创建变量（对象，字符串等）时自动进行了内存分配，当变量不再被引用时，系统会自动释放变量所占用的内存空间，这一过程称为垃圾回收。
这种机制有助于减少内存泄漏和提高内存利用率。


#### 内存生命周期

1. 分配你所需要的内存
2. 使用分配到的内存（读、写）
3. 不需要时将其释放(归还)


##### 垃圾回收的算法
- 引用计数算法
	- 一种简单的垃圾回收算法，基本思想是记录每个对象被引用的次数，当引用次数为0时，就将该对象回收。但是这种算法会存在一个问题：当两个对象相互引用时，它们的引用计数都不为0，导致无法回收。
- 标记清除算法
	- 标记清除算法是一种常用的垃圾回收算法，它的基本思想是通过标记所有活动对象，然后清除未标记的对象
		- 标记阶段
			- 从根对象开始，标记所有从根对象可达的对象，即活动对象。这个过程会遍历整个对象图。
			- 当变量从根节点无法触达时，就意味着这个变量不会再被使用了，就是可以回收的了
		- 清除阶段
			- 清除未被标记的对象，即垃圾对象
		- 需要注意的是，标记清除算法会造成内存碎片问题。为了避免这个问题，通常会使用标记整理算法来优化清除阶段。标记整理算法会在清除阶段之前，将所有活动对象向一端移动，然后清除另一端的垃圾对象
		- 总的来说，标记清除算法是一种效率较高、可靠性较高的垃圾回收算法。在现代浏览器中，通常采用标记清除算法来进行垃圾回收。

##### JavaScript和Node.js的垃圾回收机制差异
- Node.js基于V8引擎
- V8引擎采用了分代回收的方式，将内存分为新生代和老生代两部分
	- 新生代
		- 用于存储生命周期较短的对象，如临时变量等
		- 特点
			- 容量小
			- 垃圾回收速度更快
	- 老生代
		- 多次在新生代的未被清理掉的变量
		- 用于存储生命周期较长的对象，如全局变量、常驻内存的对象等
		- 特点
			- 容量大
			- 垃圾回收更慢
			- 标记阶段，遍历所有对象，标记存活的对象、清除未标记的对象
				- 该动作，会造成内存碎片（非连续的内存空间）
				- 在整理的过程中，存活对象往一边移动，移动完成后，直接清理掉边界外内存
