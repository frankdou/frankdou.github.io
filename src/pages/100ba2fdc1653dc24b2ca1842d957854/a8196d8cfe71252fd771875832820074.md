---
title: ajax、fetch
date: 2022-04-14T12:00:22.514Z
size: 1960
---
##### ajax

- XMLHttpRequest

- 属性设置

  - responseType
  - timeout

- 事件绑定

  - open(method, url，*async)
    - async为可选参数，默认为true
    - 如果值为`false`，`send()`方法直到收到答复前不会返回，会导致屏幕上出现“冻结”和无响应的用户体验
    - 页面卸载时，可以设置为true，延迟页面的卸载，进行日志提交
  - send
  - loadstart
  - load
  - progress
  - error
  - abort
  - ontimeout
  - loadend：可以侦测到所有的三种加载结束条件（abort、load，或 error）
  - onreadystatechange：请求被取消时，其对应的readystatechange 事件不会被触发
    - readyState === 4  请求成功
    - request.status === 200  服务无异常
    - 通过responseText拿到响应的文本，二进制是response

- abort方法用于终止请求

- 上传相关事件在 `XMLHttpRequest.upload` 对象上被触发

  ```js
  var oReq = new XMLHttpRequest();
  
  oReq.upload.addEventListener("progress", updateProgress);
  oReq.upload.addEventListener("load" , transferComplete);
  oReq.upload.addEventListener("error", transferFailed  );
  oReq.upload.addEventListener("abort", transferCanceled);
  
  oReq.open();
  ```

##### fetch

- 参数
  - 要获取的资源地址
  - 配置项对象
- 优点
  - 语法简洁，更加语义化
  - 基于标准 Promise 实现，支持 async/await
  - Fetch 提供了对 [`Request`](https://developer.mozilla.org/zh-CN/docs/Web/API/Request) 和 [`Response`](https://developer.mozilla.org/zh-CN/docs/Web/API/Response) （以及其他与网络请求有关的）对象的通用定义，使之可以被应用到更多的场景中
- 缺点
  - ie不支持，需要polyfill
  - 不能取消请求（实验性支持中）
  - 默认不会带cookie，需要添加配置项
  - 原生不支持请求进度的监测



ref:

https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Sending_and_Receiving_Binary_Data
