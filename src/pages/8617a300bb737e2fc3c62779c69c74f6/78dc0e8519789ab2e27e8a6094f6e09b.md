---
title: 进程间通信
size: 2748
---
##### 使用 IPC（进程间通信）
这是最推荐和安全的方式。因为 Electron 的渲染进程和主进程（Node.js 环境，可以访问原生 API）是分离的。

- 在渲染进程中，使用 `ipcRenderer` 模块向主进程发送消息
- 在主进程中，使用 `ipcMain` 模块监听这些消息，然后执行相应的操作（如创建新窗口或调用原生 API），并将结果返回给渲染进程

main.js（主进程）
```js
const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');

let mainWindow;

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'), // 预加载脚本
      nodeIntegration: false, // 禁用 Node.js 集成，更安全
      contextIsolation: true // 开启上下文隔离，更安全
    }
  });

  mainWindow.loadURL('file://' + path.join(__dirname, 'index.html'));

  mainWindow.on('closed', () => {
    mainWindow = null;
  });
}

app.whenReady().then(() => {
  createWindow();
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow();
  }
});

// 监听渲染进程发送的 'open-new-window' 消息
ipcMain.on('open-new-window', (event, data) => {
  const newWindow = new BrowserWindow({
    width: 400,
    height: 300,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: false,
      contextIsolation: true
    }
  });
  newWindow.loadURL(data.url);
  event.reply('new-window-opened', '新窗口已打开！'); // 可以回复渲染进程
});
```

preload.js
```js
const { contextBridge, ipcRenderer } = require('electron');

contextBridge.exposeInMainWorld('electronAPI', {
  openNewWindow: (url) => ipcRenderer.send('open-new-window', { url }),
  onNewWindowOpened: (callback) => ipcRenderer.on('new-window-opened', (event, message) => callback(message))
});
```

index.html（渲染进程）
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electron IPC 示例</title>
</head>
<body>
  <h1>Electron IPC 示例</h1>
  <button id="open-window-btn">打开新窗口</button>
  <p id="version-display"></p>

  <script>
    document.getElementById('open-window-btn').addEventListener('click', () => {
      // 通过预加载脚本暴露的 API 调用主进程方法
      window.electronAPI.openNewWindow('https://www.baidu.com');
    });
    // 监听主进程的回复
    window.electronAPI.onNewWindowOpened((message) => {
      console.log(message); // 例如：新窗口已打开！
    });
  </script>
</body>
</html>
```


