---
title: 基本原理
size: 2227
---
HTTPS还是通过HTTP来传输信息，但是通过TLS协议进行了加密

#### 要点
加密通信
使用 SSL/TLS 协议建立安全通信通道,对 HTTP 通信内容加密,避免网络抓包监听。具体来说,客户端和服务器会首先协商出一个对称加密算法和密钥,然后使用该密钥对通信内容进行加密。

身份认证
使用数字证书验证服务器的身份,避免用户通信内容被中间人篡改或监听。数字证书由证书颁发机构签名发放,包含网站域名、公钥等信息。客户端可以验证证书的有效性和域名信息,确认用户访问的服务器身份是正确的。

#### 具体工作流程

##### 客服端发请求
携带基础信息
- 支持的协议版本
- 支持的加密方法
- 支持的压缩方法
- 客户端生成的随机值

##### 服务器响应
- 确认协议版本
- 确认加密方法
- 发送证书
- 收到客户端的随机值，也产生一个随机值，发送至客户端

##### 客户端回应
- CA（浏览器、系统内置）验证证书是否有效
	- 对比摘要是否一致（域名等）
	- 是否过期等
- 证书验证通过
	- 获得该服务的公钥
	- 客户端生成一个随机的对称加密密钥,使用服务器公钥加密后发送给服务器

##### 服务器的最后回应
- 服务器使用私钥解密,获取到对称加密密钥
- 各自生成会话所用的会话密钥（通过三个随机数生成）
- 编码改变通知
	- 后续使用商定好的对称加密方式、会话密钥进行通信


#### tips：

#### CA认证机构
浏览器、系统内置根证书，对网站证书进行验证

##### 握手阶段
两端使用**非对称加密**的方式来通信，但是因为非对称加密损耗的性能比对称加密大

##### 正式传输数据
两端使用**对称加密**的方式通信

##### 为什么一定要用三个随机数，来生成密钥
由于SSL协议中证书是静态的，因此十分有必要引入一种随机因素来保证协商出来的密钥的随机性

##### 申请证书
- 生成服务器公钥、私钥
- 生成CSR文件（基本信息 + 公钥）
- 提交CSR文件至CA（根证书颁发机构），签发证书

##### 金融类
使用U盾等客户端证书
